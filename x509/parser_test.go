package x509

import (
	"crypto/ecdsa"
	"encoding/base64"
	"fmt"
	"github.com/mmdet/mcrypto/sm2"
	"testing"
)

func TestCertSM2Parser(t *testing.T) {
	cert := "MIIDYTCCAkmgAwIBAgINAOvz5nMnGmq+uK63fjANBgkqhkiG9w0BAQsFADAxMQswCQYDVQQGEwJDTjERMA8GA1UECgwIQUJDIGx0ZC4xDzANBgNVBAMMBmNhLWdlbjAeFw0yMTEyMDgwMDAxNDJaFw0zMTEyMDgwMDAxNDJaMB8xHTAbBgNVBAMMFHNwYXJr5Lia5Yqh566h55CG5ZGYMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAx+d9vGSZtn93abXh9UKVgkIsyd5JzR5JKqG3IXzIH87kLBfsiHBy1Sq9DULjUCnMg/EiSyA/ecKtUP/8O6uLWsNCm5B6D419/r1XLcxJduIPnJPYKRA6pqSwZ4AfopqzrKF06B2liUXOwxH4PZAdSs/eO49uDJqLJXKAhGBprF/Bgr2pC0C+G/V7hDTlWPjeNCh0QWh1DHfSzzdPhXDSzYGmwKEa5+SQv1dn9u/b/yM/iMT6XIP0W5TQMWL5NZ10ME5Lqi9tINQ3xdPqYoszCZ/sREKOjts/PGsAIIe+CUXQLDO1zf02hCiG9a7oTjKCfBZznqCvPauUNUkUiGc2qwIDAQABo4GJMIGGMAkGA1UdEwQCMAAwHQYDVR0OBBYEFMUh7pxA9oRronVD+p7zJ6KZeRR5MCkGA1UdJQQiMCAGCCsGAQUFBwMCBggrBgEFBQcDBAYKKwYBBAGCNwoDBDAfBgNVHSMEGDAWgBRRRbE0SlfNI2qg2O9kY58PKI/FNzAOBgNVHQ8BAf8EBAMCA/gwDQYJKoZIhvcNAQELBQADggEBAJrdEyl/Yq6elLCHZpo6g9rEHzLaMLG3Pq47vDD8Bbf3YLctMWSVrzUZVZCt8nVI8iVT5jYxxoIpoKlydMAopUhZkJuRJC2dXX1YsmYqCSAyV0B4mDbEV5xaTSqYegzYjOBK2RUMvi+7zAupygKa/lJNDuf/ufgFbknIUyZuJeUp3SEzsudcNnIgrVEps3f6jo2nAFvzu3TEChwyY3LUo3CFjlnrBeWrN4oyq7ky8cXsf9l3ewlV8ueAp6Yu9JoQBE402BXnCp5nhSZpgEovc5Zo8/mzwRCG03KiYpjJoykKU908LkRM5EbPNja8DwzbxYF9QlJqBpoccevVQUhWDF0="
	//cert := "MIIChDCCAiqgAwIBAgINAIEDr/XzbH3kCHN4QzAKBggqgRzPVQGDdTAnMQswCQYDVQQGEwJDTjEYMBYGA1UEAwwPc20yLWNhLTIwMjIwMzI4MB4XDTIzMDEwMzA3MTk1NVoXDTI0MDEwMzA3MTk1NVowDzENMAsGA1UEAwwEMjAyMzBZMBMGByqGSM49AgEGCCqBHM9VAYItA0IABKhw7Fc1wddq6IJgBRZ9mlxx7zw4mU/XXxt8+ZSAOEaWw4dDcfI92gaJfIlK0FwXk/FzPELqNvfOuMEFCyMq0i+jggFRMIIBTTAMBgNVHRMEBTADAQH/MB0GA1UdDgQWBBSYcCsEzHNxDnZuSCm/5IQclvHicTAOBgNVHQ8BAf8EBAMCAsQwFgYDVR0lAQH/BAwwCgYIKwYBBQUHAwMwLgYDVR0fBCcwJTAjoCGgH4YdaHR0cHM6Ly9haWEuc3lhbi5jb20uY24vY3JsL2EwYgYIKwYBBQUHAQEEVjBUMCQGCCsGAQUFBzABhhhodHRwczovL29jc3Auc3lhbi5jb20uY24wLAYIKwYBBQUHMAKGIGh0dHBzOi8vYWlhLnN5YW4uY29tLmNuL2lzc3Vlci9hMB8GA1UdIwQYMBaAFKWLpnm6/vqq/Z8YHzgWRhB/KTdbMEEGA1UdIAQ6MDgwNgYIKoEchvAAZAEwKjAoBggrBgEFBQcCARYcaHR0cHM6Ly9jcHMuc3lhbi5jb20uY24vY3BzMTAKBggqgRzPVQGDdQNIADBFAiEAm8T44EWCyAbt5vGa08ou7X20OF0q85zGM3kAeJ1RE5QCIC6sJ9T97UzK08fHul8MwJ49PV98Xv0mq1JxKUoCiS8f"
	certBytes, _ := base64.StdEncoding.DecodeString(cert)
	c, _ := parseCertificate(certBytes)

	pub := c.PublicKey

	switch pub := pub.(type) {
	case *sm2.PublicKey:
		in := []byte("0a4306054d48fa88de5b876cfe5a335cd049de464af911ee9ceb72d7a0353824")
		clientSignature := "MEQCIBEaxr2EKGUmgVLbpYbYVPbHG09TIXRKBEW04tKsbCXOAiAatYMx5tirsmokvpcx6hednzME5fZG+agG80tAuHzA1A=="
		sign, _ := base64.StdEncoding.DecodeString(clientSignature)
		v := sm2.Verify(pub, in, nil, sign)
		fmt.Println(v)
	case *ecdsa.PublicKey:

	}
}
